<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Dashboard de Ocorr√™ncias - El√©trica Serpal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    :root {
      --bg: #edf0f7;
      --card-bg: #ffffff;
      --primary: #0a2b70;
      --accent: #f58120;
      --text-main: #222;
      --text-muted: #6c7280;
      --border: #dde2ec;
      --danger: #e53935;
      --warning: #f6a623;
      --success: #2e7d32;
      --high: #fb8c00;
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #fefefe 0, #edf0f7 50%, #e1e6f2 100%);
      color: var(--text-main);
      line-height: 1.4;
    }

    body {
      min-height: 100vh;
    }

    header {
      background: linear-gradient(135deg, var(--primary), #071b49);
      color: #fff;
      padding: 18px 24px;
      display: flex;
      align-items: flex-start;
      justify-content: center;
    }

    header-inner {
      max-width: 1200px;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      flex-wrap: wrap;
    }

    h1 {
      font-size: 1.4rem;
      margin: 0 0 4px 0;
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    header span {
      font-size: 0.9rem;
      opacity: 0.9;
    }

    .tag {
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.25);
      font-size: 0.75rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .page {
      max-width: 1200px;
      margin: 0 auto;
      padding: 18px 16px 24px;
    }

    .container {
      display: grid;
      grid-template-columns: minmax(0, 360px) minmax(0, 1fr);
      gap: 18px;
    }

    @media (max-width: 900px) {
      .container {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: var(--card-bg);
      border-radius: 14px;
      padding: 16px 18px 18px;
      box-shadow: 0 12px 28px rgba(15, 23, 42, 0.08);
      border: 1px solid rgba(148, 163, 184, 0.25);
      backdrop-filter: blur(4px);
    }

    .card h2 {
      margin: 0 0 8px 0;
      font-size: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .card h2 span {
      font-size: 0.78rem;
      color: var(--text-muted);
      font-weight: 400;
    }

    label {
      display: block;
      font-size: 0.8rem;
      font-weight: 600;
      margin-top: 10px;
      margin-bottom: 4px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    input[type="text"],
    input[type="date"],
    select,
    textarea {
      width: 100%;
      padding: 8px 10px;
      border-radius: 9px;
      border: 1px solid var(--border);
      font-size: 0.9rem;
      background: #f9fafb;
      transition: border 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
    }

    textarea {
      resize: vertical;
      min-height: 72px;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(245,129,32,0.5);
      background: #ffffff;
    }

    .row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .row > div {
      flex: 1;
      min-width: 160px;
    }

    .btn {
      margin-top: 14px;
      padding: 9px 16px;
      border-radius: 999px;
      border: none;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition:
        transform 0.1s ease,
        box-shadow 0.1s ease,
        background 0.1s ease,
        filter 0.1s ease;
      letter-spacing: 0.02em;
    }

    .btn-primary {
      background: var(--accent);
      color: #fff;
      box-shadow: 0 10px 20px rgba(245,129,32,0.45);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      filter: brightness(1.02);
      box-shadow: 0 14px 26px rgba(245,129,32,0.55);
    }

    .btn-primary:active {
      transform: translateY(0);
      box-shadow: 0 6px 14px rgba(245,129,32,0.45);
    }

    .small-muted {
      font-size: 0.78rem;
      color: var(--text-muted);
      margin-top: 8px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 9px;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
      white-space: nowrap;
    }

    .badge-green { background: rgba(46,125,50,0.08); color: var(--success); }
    .badge-yellow { background: rgba(246,166,35,0.12); color: #8c6400; }
    .badge-orange { background: rgba(251,140,0,0.12); color: var(--high); }
    .badge-red { background: rgba(229,57,53,0.12); color: var(--danger); }

    .pill-setor {
      padding: 3px 9px;
      border-radius: 999px;
      background: rgba(10,43,112,0.06);
      border: 1px solid rgba(10,43,112,0.12);
      font-size: 0.76rem;
      color: var(--primary);
      white-space: nowrap;
    }

    .dashboard-summary {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 6px;
      margin-bottom: 10px;
    }

    .summary-card {
      flex: 1;
      min-width: 170px;
      background: linear-gradient(135deg, #f9fafb, #eef1f9);
      border-radius: 12px;
      padding: 9px 11px;
      border: 1px solid var(--border);
      font-size: 0.8rem;
    }

    .summary-label {
      font-size: 0.72rem;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    .summary-value {
      font-weight: 700;
      margin-top: 3px;
      font-size: 0.95rem;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .empty-state {
      font-size: 0.8rem;
      color: var(--text-muted);
      padding: 12px 0;
      text-align: center;
    }

    /* TABELA / LISTA */

    .table-wrapper {
      width: 100%;
      overflow-x: auto;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #f9fafb;
      margin-top: 6px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
      min-width: 500px;
    }

    thead {
      background: #eef1f7;
    }

    th, td {
      padding: 7px 8px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }

    th {
      font-weight: 600;
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.04em;
      white-space: nowrap;
    }

    tbody tr {
      cursor: pointer;
      transition: background 0.12s ease;
    }

    tbody tr:hover {
      background: #e8eefc;
    }

    tbody tr.selected {
      background: #d8e3ff;
    }

    /* RESUMO T√âCNICO */

    .resumo-section {
      margin-top: 6px;
    }

    .resumo-section h3 {
      margin-top: 0;
      margin-bottom: 4px;
      font-size: 0.98rem;
    }

    .resumo-section h4 {
      margin: 10px 0 4px;
      font-size: 0.9rem;
    }

    .resumo-section p,
    .resumo-section li {
      font-size: 0.82rem;
      line-height: 1.45;
    }

    .resumo-section ul {
      margin-top: 2px;
      padding-left: 18px;
    }

    hr.divider {
      margin: 14px 0 12px;
      border: none;
      border-top: 1px dashed var(--border);
    }
  </style>
</head>
<body>
<header>
  <header-inner>
    <div>
      <h1>Dashboard de Ocorr√™ncias Internas ¬∑ El√©trica Serpal</h1>
      <span>Monitoramento de desvios de processo por setor ¬∑ Estoque, Log√≠stica, Vendas, Financeiro, RH e mais</span>
    </div>
    <div class="tag">
      üîé Monitor de Processos
    </div>
  </header-inner>
</header>

<div class="page">
  <div class="container">
    <!-- FORMUL√ÅRIO DE INPUT -->
    <section class="card">
      <h2>
        Nova ocorr√™ncia
        <span>Preencha os dados para registrar um desvio de processo</span>
      </h2>

      <div class="row">
        <div>
          <label for="setor">Setor</label>
          <select id="setor">
            <option value="">Selecione...</option>
            <option value="Estoque">üè≠ Estoque</option>
            <option value="Log√≠stica / Entregas">üöö Log√≠stica / Entregas</option>
            <option value="Financeiro">üßæ Financeiro</option>
            <option value="Vendas / E-commerce">üõí Vendas / E-commerce</option>
            <option value="Atendimento / Comercial">üßë‚Äçüíº Atendimento / Comercial</option>
            <option value="Loja F√≠sica / Balc√£o">üß± Loja F√≠sica / Balc√£o</option>
            <option value="RH / Pessoas">üë• RH / Pessoas</option>
          </select>
        </div>
        <div>
          <label for="filial">Filial / Unidade</label>
          <input type="text" id="filial" placeholder="Ex: Rondon√≥polis, Matriz, Filial 02...">
        </div>
      </div>

      <div class="row">
        <div>
          <label for="data">Data da ocorr√™ncia</label>
          <input type="date" id="data">
        </div>
        <div>
          <label for="responsavel">Respons√°vel (opcional)</label>
          <input type="text" id="responsavel" placeholder="Nome ou cargo">
        </div>
      </div>

      <label for="tipo">Tipo de ocorr√™ncia</label>
      <select id="tipo">
        <option value="">Selecione...</option>
        <option value="Separa√ß√£o errada de produto">Separa√ß√£o errada de produto</option>
        <option value="Produto com defeito">Produto com defeito</option>
        <option value="C√≥digo do produto errado">C√≥digo do produto errado</option>
        <option value="Entrega errada de filial">Entrega errada de filial</option>
        <option value="Atraso na entrega">Atraso na entrega</option>
        <option value="Problema de faturamento / nota fiscal">Problema de faturamento / nota fiscal</option>
        <option value="Erro de cadastro em sistema">Erro de cadastro em sistema</option>
        <option value="Outro">Outro</option>
      </select>

      <label for="gravidade">Gravidade (Risco)</label>
      <select id="gravidade">
        <option value="">Selecione...</option>
        <option value="Baixo">üü¢ Baixo</option>
        <option value="M√©dio">üü° M√©dio</option>
        <option value="Alto">üü† Alto</option>
        <option value="Cr√≠tico">üî¥ Cr√≠tico</option>
      </select>

      <label for="descricao">Descri√ß√£o resumida da ocorr√™ncia</label>
      <textarea id="descricao" placeholder="Explique de forma objetiva o que aconteceu..."></textarea>

      <button class="btn btn-primary" id="btnAdicionar">
        ‚ûï Adicionar ocorr√™ncia
      </button>

      <p class="small-muted">
        Use este painel para registrar erros como separa√ß√£o errada de produto, produto com defeito, entrega errada de filial,
        falhas de cadastro, atrasos, problemas de faturamento e outras n√£o conformidades internas.
      </p>
    </section>

    <!-- DASHBOARD + RESUMO -->
    <section class="card">
      <h2>
        Dashboard de ocorr√™ncias
        <span>Selecione uma linha para gerar o resumo t√©cnico da a√ß√£o</span>
      </h2>

      <div class="dashboard-summary" id="dashboardResumoTop">
        <div class="summary-card">
          <div class="summary-label">Total de ocorr√™ncias</div>
          <div class="summary-value" id="totalOcorrencias">0</div>
        </div>
        <div class="summary-card">
          <div class="summary-label">Setor com mais registros</div>
          <div class="summary-value" id="setorDestaque">-</div>
        </div>
        <div class="summary-card">
          <div class="summary-label">Maior risco atual</div>
          <div class="summary-value" id="maiorRisco">-</div>
        </div>
      </div>

      <div id="listaOcorrenciasWrapper">
        <div class="empty-state" id="semOcorrenciasMsg">
          Nenhuma ocorr√™ncia registrada ainda. Adicione uma no painel √† esquerda.
        </div>

        <div class="table-wrapper" id="tableWrapper" style="display:none;">
          <table id="tabelaOcorrencias">
            <thead>
              <tr>
                <th>ID</th>
                <th>Setor</th>
                <th>Ocorr√™ncia</th>
                <th>Gravidade</th>
                <th>Filial</th>
              </tr>
            </thead>
            <tbody id="tbodyOcorrencias">
            </tbody>
          </table>
        </div>
      </div>

      <hr class="divider">

      <div class="resumo-section" id="resumoTecnico">
        <h3>Resumo t√©cnico da a√ß√£o</h3>
        <p class="small-muted">
          Selecione uma ocorr√™ncia na tabela acima para gerar automaticamente o resumo t√©cnico:
          diagn√≥stico, causas prov√°veis, a√ß√µes corretivas, a√ß√µes preventivas e indicadores de acompanhamento.
        </p>
      </div>
    </section>
  </div>
</div>

<script>
  const ocorrencias = [];
  const btnAdicionar = document.getElementById('btnAdicionar');
  const tbodyOcorrencias = document.getElementById('tbodyOcorrencias');
  const tabelaOcorrencias = document.getElementById('tabelaOcorrencias');
  const tableWrapper = document.getElementById('tableWrapper');
  const semOcorrenciasMsg = document.getElementById('semOcorrenciasMsg');
  const totalOcorrenciasSpan = document.getElementById('totalOcorrencias');
  const setorDestaqueSpan = document.getElementById('setorDestaque');
  const maiorRiscoSpan = document.getElementById('maiorRisco');
  const resumoTecnicoDiv = document.getElementById('resumoTecnico');

  function gravidadeBadge(gravidade) {
    switch (gravidade) {
      case 'Baixo':
        return '<span class="badge badge-green">üü¢ Baixo</span>';
      case 'M√©dio':
        return '<span class="badge badge-yellow">üü° M√©dio</span>';
      case 'Alto':
        return '<span class="badge badge-orange">üü† Alto</span>';
      case 'Cr√≠tico':
        return '<span class="badge badge-red">üî¥ Cr√≠tico</span>';
      default:
        return '<span class="badge badge-yellow">-</span>';
    }
  }

  function compararGravidade(g1, g2) {
    const pesos = { 'Baixo': 1, 'M√©dio': 2, 'Alto': 3, 'Cr√≠tico': 4 };
    return (pesos[g1] || 0) - (pesos[g2] || 0);
  }

  function atualizarDashboard() {
    const total = ocorrencias.length;
    totalOcorrenciasSpan.textContent = total;

    if (total === 0) {
      setorDestaqueSpan.textContent = '-';
      maiorRiscoSpan.textContent = '-';
      tabelaOcorrencias.style.display = 'none';
      tableWrapper.style.display = 'none';
      semOcorrenciasMsg.style.display = 'block';
      return;
    }

    const contagemPorSetor = {};
    let setorDestaque = '';
    let maiorQtde = 0;
    let maiorGravidade = null;

    ocorrencias.forEach(o => {
      contagemPorSetor[o.setor] = (contagemPorSetor[o.setor] || 0) + 1;
      if (contagemPorSetor[o.setor] > maiorQtde) {
        maiorQtde = contagemPorSetor[o.setor];
        setorDestaque = o.setor;
      }
      if (!maiorGravidade || compararGravidade(o.gravidade, maiorGravidade) > 0) {
        maiorGravidade = o.gravidade;
      }
    });

    setorDestaqueSpan.textContent = setorDestaque || '-';
    maiorRiscoSpan.innerHTML = gravidadeBadge(maiorGravidade);

    tabelaOcorrencias.style.display = 'table';
    tableWrapper.style.display = 'block';
    semOcorrenciasMsg.style.display = 'none';
  }

  function limparSelecaoTabela() {
    [...tbodyOcorrencias.querySelectorAll('tr')].forEach(tr => {
      tr.classList.remove('selected');
    });
  }

  function gerarResumoTecnico(ocorrencia) {
    const data = ocorrencia.data || 'n√£o informado';
    const filial = ocorrencia.filial || 'n√£o informada';

    const diagnostico = `Foi registrada uma ocorr√™ncia no setor de ${ocorrencia.setor}, classificada como "${ocorrencia.tipo}" com gravidade ${ocorrencia.gravidade}. ` +
      `A descri√ß√£o informada foi: "${ocorrencia.descricao || 'sem detalhamento'}". A filial envolvida √© ${filial}, com data da ocorr√™ncia ${data}.`;

    let causas = [];
    if (ocorrencia.setor === 'Estoque') {
      if (ocorrencia.tipo.includes('Separa√ß√£o errada')) {
        causas = [
          'Falta de confer√™ncia dupla na separa√ß√£o dos itens.',
          'Layout ou endere√ßamento do estoque confuso, dificultando a identifica√ß√£o correta do produto.',
          'Press√£o por tempo na prepara√ß√£o dos pedidos, reduzindo o cuidado na confer√™ncia.',
          'Poss√≠vel falha de comunica√ß√£o entre vendas e estoque sobre o item exato solicitado.'
        ];
      } else if (ocorrencia.tipo.includes('Produto com defeito')) {
        causas = [
          'Falha na inspe√ß√£o visual do produto no recebimento.',
          'Defeito de fabrica√ß√£o n√£o identificado no processo de entrada.',
          'Aus√™ncia de pol√≠tica estruturada de testes ou amostragem.',
          'Armazenagem inadequada, podendo causar danos ao produto.'
        ];
      } else if (ocorrencia.tipo.includes('C√≥digo do produto errado')) {
        causas = [
          'Erro de cadastro no sistema (c√≥digo e descri√ß√£o divergentes).',
          'Etiqueta f√≠sica divergente do cadastro interno.',
          'Migra√ß√£o de dados sem valida√ß√£o dos c√≥digos.',
          'Falta de padroniza√ß√£o na cria√ß√£o de novos produtos.'
        ];
      } else if (ocorrencia.tipo.includes('Entrega errada de filial')) {
        causas = [
          'Confer√™ncia insuficiente do destino no momento da expedi√ß√£o.',
          'Etiquetagem dos volumes sem identifica√ß√£o clara da filial.',
          'Escolha incorreta da filial no sistema na emiss√£o do pedido.',
          'Falta de integra√ß√£o entre estoque e log√≠stica na valida√ß√£o de rotas.'
        ];
      }
    }

    if (causas.length === 0) {
      causas = [
        'Falha de procedimento em alguma etapa do processo.',
        'Aus√™ncia ou n√£o cumprimento de checklist operacional.',
        'Comunica√ß√£o incompleta entre as √°reas envolvidas.',
        'Falta de treinamento espec√≠fico sobre o fluxo correto.'
      ];
    }

    const acoesCorretivas = [
      'Registrar formalmente a ocorr√™ncia no controle interno de n√£o conformidades.',
      'Verificar imediatamente o impacto no cliente ou filial e realizar os ajustes necess√°rios.',
      'Rever o pedido, nota fiscal e movimenta√ß√µes de estoque relacionadas √† ocorr√™ncia.',
      'Comunicar os respons√°veis do setor para ci√™ncia e corre√ß√£o pontual do problema.'
    ];

    const acoesPreventivas = [
      'Revisar e refor√ßar o procedimento operacional padr√£o (POP) do setor.',
      'Implantar ou atualizar checklists de confer√™ncia nas etapas cr√≠ticas.',
      'Promover treinamento r√°pido com a equipe diretamente envolvida.',
      'Avaliar necessidade de melhoria de sistema (campos obrigat√≥rios, travas, alertas).'
    ];

    const indicadores = [
      'N√∫mero de ocorr√™ncias por tipo e por setor (semanal/mensal).',
      'Percentual de pedidos com retrabalho por erro de processo.',
      'Tempo m√©dio de corre√ß√£o das ocorr√™ncias.',
      '√çndice de reincid√™ncia do mesmo tipo de desvio.'
    ];

    const responsavelSugerido =
      ocorrencia.setor === 'Estoque'
        ? 'Encarregado / Coordenador de Estoque'
        : 'Gestor respons√°vel pelo setor da ocorr√™ncia';

    resumoTecnicoDiv.innerHTML = `
      <h3>Resumo t√©cnico da ocorr√™ncia selecionada</h3>
      <p class="small-muted">Resumo gerado automaticamente com base nos dados informados e na l√≥gica de risco definida para a Serpal.</p>

      <p><strong>Setor:</strong> ${ocorrencia.setor || '-'}<br>
      <strong>Ocorr√™ncia:</strong> ${ocorrencia.tipo || '-'}<br>
      <strong>Gravidade:</strong> ${gravidadeBadge(ocorrencia.gravidade)}<br>
      <strong>Filial impactada:</strong> ${filial}<br>
      <strong>Data da ocorr√™ncia:</strong> ${data}<br>
      <strong>Respons√°vel informado:</strong> ${ocorrencia.responsavel || 'n√£o informado'}</p>

      <h4>1. Diagn√≥stico r√°pido</h4>
      <p>${diagnostico}</p>

      <h4>2. Causas prov√°veis</h4>
      <ul>
        ${causas.map(c => `<li>${c}</li>`).join('')}
      </ul>

      <h4>3. A√ß√£o corretiva imediata (recomendada)</h4>
      <ul>
        ${acoesCorretivas.map(a => `<li>${a}</li>`).join('')}
      </ul>

      <h4>4. A√ß√µes preventivas sugeridas</h4>
      <ul>
        ${acoesPreventivas.map(a => `<li>${a}</li>`).join('')}
      </ul>

      <h4>5. Indicadores para acompanhamento</h4>
      <ul>
        ${indicadores.map(i => `<li>${i}</li>`).join('')}
      </ul>

      <h4>6. Pr√≥ximos passos e respons√°veis</h4>
      <p>
        <strong>Respons√°vel sugerido:</strong> ${responsavelSugerido}<br>
        <strong>Prazo recomendado:</strong> at√© 24h para corre√ß√£o e registro da ocorr√™ncia.<br>
        <strong>Status recomendado:</strong> Em acompanhamento at√© valida√ß√£o da corre√ß√£o.
      </p>
    `;
  }

  btnAdicionar.addEventListener('click', () => {
    const setor = document.getElementById('setor').value;
    const filial = document.getElementById('filial').value.trim();
    const data = document.getElementById('data').value;
    const responsavel = document.getElementById('responsavel').value.trim();
    const tipo = document.getElementById('tipo').value;
    const gravidade = document.getElementById('gravidade').value;
    const descricao = document.getElementById('descricao').value.trim();

    if (!setor || !tipo || !gravidade || !descricao) {
      alert('Preencha pelo menos: Setor, Tipo de ocorr√™ncia, Gravidade e Descri√ß√£o.');
      return;
    }

    const id = ocorrencias.length + 1;
    const novaOcorrencia = {
      id,
      setor,
      filial,
      data,
      responsavel,
      tipo,
      gravidade,
      descricao
    };

    ocorrencias.push(novaOcorrencia);

    const tr = document.createElement('tr');
    tr.dataset.id = id;
    tr.innerHTML = `
      <td>${String(id).padStart(2, '0')}</td>
      <td><span class="pill-setor">${setor}</span></td>
      <td>${tipo}</td>
      <td>${gravidadeBadge(gravidade)}</td>
      <td>${filial || '-'}</td>
    `;

    tr.addEventListener('click', () => {
      limparSelecaoTabela();
      tr.classList.add('selected');
      gerarResumoTecnico(novaOcorrencia);
    });

    tbodyOcorrencias.appendChild(tr);

    atualizarDashboard();

    document.getElementById('tipo').value = '';
    document.getElementById('gravidade').value = '';
    document.getElementById('descricao').value = '';
  });
</script>
</body>
</html>
